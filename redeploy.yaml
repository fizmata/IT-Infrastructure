---
  - name: testing connection
    hosts: all
    roles:
      - test_connection
    tags:
      - test
      - ping

  - name: nginx
    hosts: all
    become: yes
    roles:
      - reverse_proxy
      - nginx_exporter
    tags:
      - nginx
      - prometheus

  - name: uwsgi
    hosts: app_servers
    become: yes
    roles:
      - uwsgi
    tags:
      - uwsgi

  - name: agama
    hosts: app_servers
    become: yes
    roles:
      - agama
    tags:
      - agama

  - name: mysql
    hosts: db_servers
    become: yes
    roles:
      - mysql
      - mysql_exporter
    tags:
      - mysql
      - prometheus

  - name: dns
    hosts: dns_servers
    become: yes
    roles:
      - bind
      - configure_resolved
      - bind_exporter
    tags:
      - dns
      - bind
      - prometheus

  - name: prometheus
    hosts: prometheus
    become: yes
    roles:
      - prometheus
    tags:
      - prometheus
      - metrics
      - monitoring

  - name: node exporters
    hosts: all
    become: yes
    roles:
      - node_exporter
    tags:
      - prometheus
      - metrics
      - monitoring

  - name: influxdb and telegraf
    hosts: influxdb
    become: yes
    roles:
      - influxdb
      - pinger
    tags:
      - influxdb
      - metrics
      - monitoring

  - name: Configure rsyslog
    hosts: all
    become: yes
    roles:
      - rsyslog
    tags:
      - influxdb
      - metrics
      - monitoring

  - name: grafana
    hosts: grafana
    become: yes
    roles:
      - grafana
    tags:
      - grafana
      - monitoring
