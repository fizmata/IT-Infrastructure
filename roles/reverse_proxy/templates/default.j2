server{
  listen 80 default_server;
  root /var/www/html;

  {% if inventory_hostname in groups['web_servers'] %}
  location /{
    uwsgi_pass localhost:5000;
    include uwsgi_params;
  }
  {% endif %}

  location /metrics {
      proxy_pass http://localhost:9100/metrics;
  }

  {% if inventory_hostname in groups['prometheus'] %}
  location /prometheus {
      proxy_pass http://localhost:9090;
  }
  {% endif %}


  {% if inventory_hostname in groups['grafana'] %}
  location /grafana {
      proxy_pass http://localhost:3000;
  }
  {% endif %}

  {% if inventory_hostname in groups['db_servers'] %}
  location /mysql-metrics {
      proxy_pass http://localhost:9104/metrics;
  }
  {% endif %}

  {% if inventory_hostname in groups['dns_servers'] %}
  location /bind-metrics {
      proxy_pass http://localhost:9119/metrics;
  }
  {% endif %}

  {% if inventory_hostname in groups['app_servers'] %}
  location /nginx-metrics {
      proxy_pass http://localhost:9113/metrics;
  }
  {% endif %}

}
