vrrp_script check_haproxy {
    script "netstat -ntl | grep -q ':88 '"
    weight 20
    interval 1
}
static_routes {
    192.168.100.0/24 dev ens3
}
vrrp_instance elvis {
    interface ens3
    virtual_router_id 1
    priority {{ 110 if inventory_hostname == 'vm-1' else 100}}
    advert_int 1
    virtual_ipaddress {
        192.168.100.{{ hostvars['vm-1']['ansible_default_ipv4']['address'].split('.')[3] }}
    }
    unicast_peer {
{% for vm in groups['haproxy'] %}
      {{ hostvars[vm]['ansible_default_ipv4']['address'] }}
{% endfor %}
    }
    track_script {
        check_haproxy
    }
}
