---
  - name: Collect, update apt cache
    hosts: all
    become: yes
    tasks:
      - setup:
      - apt:
          update_cache: yes


  - name: haproxy
    hosts: haproxy
    become: yes
    gather_facts: no
    roles:
      - haproxy

  - name: keepalived
    hosts: haproxy
    become: yes
    gather_facts: no
    roles:
      - keepalived

  - name: haproxy exporter
    hosts: haproxy
    become: yes
    gather_facts: no
    roles:
      - docker
      - haproxy_exporter

  - name: keepalive exporter
    hosts: haproxy
    become: yes
    gather_facts: no
    roles:
      - keepalive_exporter
