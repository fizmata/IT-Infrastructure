---
  - name: Collect info about all VMs
    hosts: all
    tasks:
      - setup:

  - name: Install bind exporter
    hosts: dns_servers
    become: yes
    roles:
      - bind_exporter
    tags:
      - bind

  - name: Install mysql exporter
    hosts: db_servers
    become: yes
    roles:
      - mysql_exporter

  - name: Install nginx exporter
    hosts: app_servers
    become: yes
    roles:
      - nginx_exporter
    tags:
      - nginx

  - name: Install grafana
    hosts: grafana
    become: yes
    roles:
      - grafana
    tags:
      - grafana

  - name: Setup reverse proxy
    hosts: all
    become: yes
    roles:
      - reverse_proxy
